
version: 2
models:
  - name: bronze__orders
    columns:
      - name: total_amount
        tests:
          - not_null
          - positive_amounts
          
  - name: bronze__customers
    description: "Bronze-layer customers model in schema bronze_layer."
    columns:
      - name: customer_id
        tests: [not_null, unique]
      - name: email
        tests: [not_null, unique]

  - name: dim_customers
    description: "Customer dimension table with surrogate keys."
    columns:
      - name: customer_sk
        description: "Surrogate key generated from customer_id."
        tests:
          - not_null
          - unique
      - name: email
        description: "Customer email address."
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_values_to_match_regex:
              regex: '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'
          - dbt_expectations.expect_column_to_exist

  - name: fct_orders
    description: "Fact table containing order-level data linked to customers."
    columns:
      - name: order_id
        tests:
          - not_null
          - unique
      - name: customer_sk
        description: "Foreign key to dim_customers."
        tests:
          - relationships:
              to: ref('dim_customers')
              field: customer_sk
          - dbt_expectations.expect_column_values_to_not_be_null
      - name: total_amount
        description: "Total order value in currency."
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: -1
              strictly: true

  - name: fct_order_items
    columns:
      - name: product_sk
        tests:
          - relationships:
              to: ref('dim_products')
              field: product_sk